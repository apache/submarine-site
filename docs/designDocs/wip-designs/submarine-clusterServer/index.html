<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Submarine Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Submarine Blog Atom Feed"><title data-react-helmet="true">Cluster Server Design - High-Availability | Apache Submarine</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Cluster Server Design - High-Availability | Apache Submarine"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><meta data-react-helmet="true" property="og:url" content="https://submarine.apache.org//docs/designDocs/wip-designs/submarine-clusterServer"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://submarine.apache.org//docs/designDocs/wip-designs/submarine-clusterServer"><link rel="stylesheet" href="/styles.058db332.css">
<link rel="preload" href="/styles.2c7de434.js" as="script">
<link rel="preload" href="/runtime~main.4393a27c.js" as="script">
<link rel="preload" href="/main.b455f63a.js" as="script">
<link rel="preload" href="/1.ecc8c7d9.js" as="script">
<link rel="preload" href="/2.cd6d8673.js" as="script">
<link rel="preload" href="/1be78505.199e2b6d.js" as="script">
<link rel="preload" href="/c4f5d8e4.570bdfb0.js" as="script">
<link rel="preload" href="/78.3e9c53fe.js" as="script">
<link rel="preload" href="/77.4428181f.js" as="script">
<link rel="preload" href="/935f2afb.0881b17e.js" as="script">
<link rel="preload" href="/17896441.68a59c00.js" as="script">
<link rel="preload" href="/b60f7df5.c7348581.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="https://github.com/apache/submarine/blob/master/website/docs/assets/128-black.png?raw=true" alt="Apache Submarine Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="https://github.com/apache/submarine/blob/master/website/docs/assets/128-black.png?raw=true" alt="Apache Submarine Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Apache Submarine</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/docs/api/environment">API</a><a class="navbar__item navbar__link" href="/docs/download">Download</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apache/submarine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="http://www.apache.org/foundation/how-it-works.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Software Foundation</a></li><li><a href="http://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache License</a></li><li><a href="http://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="http://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="https://github.com/apache/submarine/blob/master/website/docs/assets/128-black.png?raw=true" alt="Apache Submarine Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="https://github.com/apache/submarine/blob/master/website/docs/assets/128-black.png?raw=true" alt="Apache Submarine Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Apache Submarine</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/api/environment">API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/download">Download</a></li><li class="menu__list-item"><a href="https://github.com/apache/submarine" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Apache</a><ul class="menu__list"><li class="menu__list-item"><a href="http://www.apache.org/foundation/how-it-works.html" target="_blank" rel="noopener noreferrer" class="menu__link">Apache Software Foundation</a></li><li class="menu__list-item"><a href="http://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="menu__link">Apache License</a></li><li class="menu__list-item"><a href="http://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="menu__link">Sponsorship</a></li><li class="menu__list-item"><a href="http://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="menu__link">Thanks</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Submarine Local Deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/kind">Setup a Kubernetes cluster using KinD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/notebook">Notebook Tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gettingStarted/python-sdk">Submarine Python SDK</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Docs</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">API documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/api/experiment">Experiment REST API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/api/environment">Environment REST API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/api/experiment-template">Experiment Template REST API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/api/notebook">Notebook REST API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Submarine SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/submarine-sdk/experiment-client">Experiment Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/submarine-sdk/model-client">Model Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/submarine-sdk/tracking">Tracking</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Submarine Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/submarine-security/spark-security/README">Submarine Spark Security Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/submarine-security/spark-security/build-submarine-spark-security-plugin">Building Submarine Spark Security Plugin</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Others</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/others/mlflow">MLflow UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/userDocs/others/tensorboard">Tensorboard</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Administrator Docs</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Submarine on Yarn</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/adminDocs/yarn/README">Running Submarine on YARN</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devDocs/README">Project Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devDocs/Dependencies">Dependencies for Submarine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devDocs/BuildFromCode">How to Build Submarine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devDocs/Development">Development Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devDocs/IntegrationTest">How to Run Integration Test</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/community/README">Apache Submarine Community</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/community/HowToCommit">Guide for Apache Submarine Committers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/community/contributing">How To Contribute to Submarine</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Design Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/designDocs/architecture-and-requirements">Architecture and Requirment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/designDocs/implementation-notes">Implementation Notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/designDocs/environments-implementation">Environments Implementation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/designDocs/experiment-implementation">Experiment Implementation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/designDocs/notebook-implementation">Notebook Implementation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/designDocs/storage-implementation">Storage Implementation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Submarine Server</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/designDocs/submarine-server/architecture">Submarine Server Implementation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/designDocs/submarine-server/experimentSpec">Generic Expeiment Spec</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">WIP Design Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/designDocs/wip-designs/submarine-launcher">Submarine Launcher</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/designDocs/wip-designs/submarine-clusterServer">Cluster Server Design - High-Availability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/designDocs/wip-designs/security-implementation">Security Implementation</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Releases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/releases/submarine-release-0.2.0">Apache Submarine Release 0.2.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/releases/submarine-release-0.3.0">Apache Submarine Release 0.3.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/releases/submarine-release-0.4.0">Apache Submarine Release 0.4.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/releases/submarine-release-0.5.0">Apache Submarine Release 0.5.0</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Cluster Server Design - High-Availability</h1></header><div class="markdown"><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>Please note that this design doc is working-in-progress and need more works to complete. </p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="below-is-existing-proposal"></a>Below is existing proposal:<a class="hash-link" href="#below-is-existing-proposal" title="Direct link to heading">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>The Submarine system contains a total of two daemon services, Submarine Server and Workbench Server.</p><p>Submarine Server mainly provides job submission, job scheduling, job status monitoring, and model online service for Submarine.</p><p>Workbench Server is mainly for algorithm users to provide algorithm development, Python/Spark interpreter operation, and other services through Notebook.</p><p>The goal of the Submarine project is to provide high availability and high-reliability services for big data processing,
algorithm development, job scheduling, model online services, model batch, and incremental updates. </p><p>In addition to the high availability of big data and machine learning frameworks,
the high availability of Submarine Server and Workbench Server itself is a key consideration.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="requirement"></a>Requirement<a class="hash-link" href="#requirement" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cluster-metadata-center"></a>Cluster Metadata Center<a class="hash-link" href="#cluster-metadata-center" title="Direct link to heading">#</a></h3><p>Multiple Submarine (or Workbench) Server processes create a Submarine Cluster through the RAFT algorithm library. </p><p>The cluster internally maintains a metadata center. All servers can operate the metadata. </p><p>The RAFT algorithm ensures that multiple processes are simultaneously co-located. </p><p>A data modification will not cause problems such as mutual coverage and dirty data.</p><p>This metadata center stores data by means of key-value pairs. it can store/support a variety of data,
but it should be noted that metadata is only suitable for storing small amounts of data and cannot be used to replace data storage.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="service-discovery"></a>Service discovery<a class="hash-link" href="#service-discovery" title="Direct link to heading">#</a></h3><p>By storing the information of the service or process in the metadata center, we can easily find the information of the service or process we need in any place,
for example, the IP address and port where the Python interpreter will be the process. Information is stored in metadata,
and other services can easily find process information through process IDs and connect to provide service discovery capabilities.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cluster-event"></a>Cluster event<a class="hash-link" href="#cluster-event" title="Direct link to heading">#</a></h3><p>In the entire Submarine cluster, the servers can communicate with each other and other child processes to send cluster events to each other. </p><p>The service or process processes the corresponding programs according to the cluster events. For example,
the Workbench Server can be managed to Python. The interpreter process sends a shutdown event that controls the operation of the services and individual subprocesses throughout the cluster.</p><p>Cluster events support both broadcast and separate delivery capabilities.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="independence"></a>Independence<a class="hash-link" href="#independence" title="Direct link to heading">#</a></h3><p>We implement Submarine&#x27;s clustering capabilities through the RAFT algorithm library, without relying on any external services (e.g. Zookeeper, Etcd, etc.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="disadvantages"></a>Disadvantages<a class="hash-link" href="#disadvantages" title="Direct link to heading">#</a></h3><p>Because the RAFT algorithm requires more than half of the servers available to ensure the normality of the RAFT algorithm,
if we need to turn on the clustering capabilities of Submarine (Workbench) Server, when more than half of the servers are unavailable,
some programs may appear abnormal. Of course, we also detected this in the system, downgrading the system or refusing to provide service status.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="system-design"></a>System design<a class="hash-link" href="#system-design" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="universal-design"></a>Universal design<a class="hash-link" href="#universal-design" title="Direct link to heading">#</a></h3><p>Modular design, Submarine (Workbench) Server exists in the Submarine system, these two services need to provide clustering capabilities,
so we abstract the cluster function into a separate module for development so that Submarine (Workbench) Server can reuse the cluster function module.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="clusterconfigure"></a>ClusterConfigure<a class="hash-link" href="#clusterconfigure" title="Direct link to heading">#</a></h3><p>Add a <code>submarine.server.addr</code> and <code>workbench.server.addr</code> configuration items in <code>submarine-site.xml</code>, <code>submarine.server.addr=ip1, ip2, ip3</code>,
through the IP list, the RAFT algorithm module in the server process can Cluster with other server processes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="clusterserver"></a>ClusterServer<a class="hash-link" href="#clusterserver" title="Direct link to heading">#</a></h3><ul><li><p>The ClusterServer module encapsulates the RAFT algorithm module, which can create a service cluster and read and write metadata based on the two configuration items submarine.server.addr or workbench.server.addr.</p></li><li><p>The cluster management service runs in each submarine server;</p></li><li><p>The cluster management service establishes a cluster by using the atomix RaftServer class of the Raft algorithm library, maintains the ClusterStateMachine,
and manages the service state metadata of each submarine server through the PutCommand, GetQuery, and DeleteCommand operation commands.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="clusterclient"></a>ClusterClient<a class="hash-link" href="#clusterclient" title="Direct link to heading">#</a></h3><ul><li><p>The ClusterClient module encapsulates the RAFT algorithm client module, which can communicate with the cluster according to the two configuration items <code>submarine.server.addr</code> or <code>workbench.server.addr</code>,
read and write metadata, and write the IP and port information of the client process. Into the cluster&#x27;s metadata center.</p></li><li><p>The cluster management client runs in each submarine server and submarine Interpreter process;</p></li><li><p>The cluster management client manages the submarine server and submarine Interpreter process state (metadata information)
in the ClusterStateMachine by using the atomix RaftClient class of the Raft library to connect to the atomix RaftServer. </p></li><li><p>When the submarine server and Submarine Interpreter processes are started, they are added to the ClusterStateMachine and are removed from the ClusterStateMachine </p></li><li><p>when the Submarine Server and Submarine Interpreter processes are closed.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="clustermetadata"></a>ClusterMetadata<a class="hash-link" href="#clustermetadata" title="Direct link to heading">#</a></h3><p>Metadata stores metadata information in a KV key-value pairã€‚
ServerMetaï¼škey=&#x27;host:port&#x27;ï¼Œvalue= {SERVER_HOST=...ï¼ŒSERVER_PORT=...ï¼Œ...}</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>SUBMARINE_SERVER_HOST</td><td>Submarine server IP</td></tr><tr><td>SUBMARINE_SERVER_PORT</td><td>Submarine server port</td></tr><tr><td>WORKBENCH_SERVER_HOST</td><td>Submarine workbench server IP</td></tr><tr><td>WORKBENCH_SERVER_PORT</td><td>Submarine workbench server port</td></tr></tbody></table><p>InterpreterMetaï¼škey=InterpreterGroupIdï¼Œvalue={INTP_TSERVER_HOST=...ï¼Œ...}</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>INTP_TSERVER_HOST</td><td>Submarine Interpreter Thrift IP</td></tr><tr><td>INTP_TSERVER_PORT</td><td>Submarine Interpreter Thrift port</td></tr><tr><td>INTP_START_TIME</td><td>Submarine Interpreter start time</td></tr><tr><td>HEARTBEAT</td><td>Submarine Interpreter heartbeat time</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="network-fault-tolerance"></a>Network fault tolerance<a class="hash-link" href="#network-fault-tolerance" title="Direct link to heading">#</a></h3><p>In a distributed environment, there may be network anomalies, network delays, or service exceptions. After submitting metadata to the cluster,
check whether the submission is successful. After the submission fails, save the metadata in the local message queue. A separate commit thread to retry;</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cluster-monitoring"></a>Cluster monitoring<a class="hash-link" href="#cluster-monitoring" title="Direct link to heading">#</a></h3><p>The cluster needs to monitor whether the Submarine Server and Submarine-Interpreter processes are working properly.</p><p>The Submarine Server and Submarine Interpreter processes periodically send heartbeats to update their own timestamps in the cluster metadata. </p><p>The Submarine Server with Leader identity periodically checks the timestamps of the Submarine Server and Submarine Interpreter processes to clear the timeout services and processes.</p><ol><li><p>The cluster monitoring module runs in each Submarine Server and Submarine Interpreter process,
periodically sending heartbeat data of the service or process to the cluster;</p></li><li><p>When the cluster monitoring module runs in Submarine Server, it sends the heartbeat to the cluster&#x27;s ClusterStateMachine.
If the cluster does not receive heartbeat information for a long time, Indicates that the service or process is abnormal and unavailable.</p></li><li><p>Resource usage statistics strategy, in order to avoid the instantaneous high peak and low peak of the server,
the cluster monitoring will collect the average resource usage in the most recent period for reporting, and improve the reasonable line and effectiveness of the server resources as much as possible;</p></li><li><p>When the cluster monitoring module runs in the Submarine Server, it checks the heartbeat data of each Submarine Server and Submarine Interpreter process.
If it times out, it considers that the service or process is abnormally unavailable and removes it from the cluster.</p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="atomix-raft-algorithm-library"></a>Atomix Raft algorithm library<a class="hash-link" href="#atomix-raft-algorithm-library" title="Direct link to heading">#</a></h3><p>In order to reduce the deployment complexity of distributed mode, submarine server does not use Zookeeper to build a distributed cluster.
Multiple submarine server groups are built into distributed clusters by using the Raft algorithm in submarine server.
The Raft algorithm is involved by atomix lib of atomix that has passed Jepsen consistency verification.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="synchronize-workbench-notes"></a>Synchronize workbench notes<a class="hash-link" href="#synchronize-workbench-notes" title="Direct link to heading">#</a></h3><p>In cluster mode, the user creates, modifies, and deletes the note on any of the servers.
All need to be notified to all the servers in the cluster to synchronize the update of Notebook.
Failure to do so will result in the user not being able to continue while switching to another server.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="listen-for-note-update-events"></a>Listen for note update events<a class="hash-link" href="#listen-for-note-update-events" title="Direct link to heading">#</a></h3><p>Listen for the NEW_NOTE, DEL_NOTE, REMOVE_NOTE_TO_TRASH ... event of the notebook in the NotebookServer#onMessage() function.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="broadcast-note-update-event"></a>Broadcast note update event<a class="hash-link" href="#broadcast-note-update-event" title="Direct link to heading">#</a></h3><p>The note is refreshed by notifying the event to all Submarine servers in the cluster via messaging Service.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/apache/submarine/edit/master/website/docs/designDocs/wip-designs/submarine-clusterServer.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/designDocs/wip-designs/submarine-launcher"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Submarine Launcher</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/designDocs/wip-designs/security-implementation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Security Implementation Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#below-is-existing-proposal" class="table-of-contents__link">Below is existing proposal:</a></li><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#requirement" class="table-of-contents__link">Requirement</a><ul><li><a href="#cluster-metadata-center" class="table-of-contents__link">Cluster Metadata Center</a></li><li><a href="#service-discovery" class="table-of-contents__link">Service discovery</a></li><li><a href="#cluster-event" class="table-of-contents__link">Cluster event</a></li><li><a href="#independence" class="table-of-contents__link">Independence</a></li><li><a href="#disadvantages" class="table-of-contents__link">Disadvantages</a></li></ul></li><li><a href="#system-design" class="table-of-contents__link">System design</a><ul><li><a href="#universal-design" class="table-of-contents__link">Universal design</a></li><li><a href="#clusterconfigure" class="table-of-contents__link">ClusterConfigure</a></li><li><a href="#clusterserver" class="table-of-contents__link">ClusterServer</a></li><li><a href="#clusterclient" class="table-of-contents__link">ClusterClient</a></li><li><a href="#clustermetadata" class="table-of-contents__link">ClusterMetadata</a></li><li><a href="#network-fault-tolerance" class="table-of-contents__link">Network fault tolerance</a></li><li><a href="#cluster-monitoring" class="table-of-contents__link">Cluster monitoring</a></li><li><a href="#atomix-raft-algorithm-library" class="table-of-contents__link">Atomix Raft algorithm library</a></li><li><a href="#synchronize-workbench-notes" class="table-of-contents__link">Synchronize workbench notes</a></li><li><a href="#listen-for-note-update-events" class="table-of-contents__link">Listen for note update events</a></li><li><a href="#broadcast-note-update-event" class="table-of-contents__link">Broadcast note update event</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api/environment">API docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/apache-submarine" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://s.apache.org/slack-invite" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/@apache.submarine" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/apache/submarine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Apache Submarine is Apache2 Licensed software.</div></div></div></footer></div>
<script src="/styles.2c7de434.js"></script>
<script src="/runtime~main.4393a27c.js"></script>
<script src="/main.b455f63a.js"></script>
<script src="/1.ecc8c7d9.js"></script>
<script src="/2.cd6d8673.js"></script>
<script src="/1be78505.199e2b6d.js"></script>
<script src="/c4f5d8e4.570bdfb0.js"></script>
<script src="/78.3e9c53fe.js"></script>
<script src="/77.4428181f.js"></script>
<script src="/935f2afb.0881b17e.js"></script>
<script src="/17896441.68a59c00.js"></script>
<script src="/b60f7df5.c7348581.js"></script>
</body>
</html>